<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>indx.DeleteME Timer</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Fredoka One', cursive;
}

body {
    min-height: 100vh;
    background: linear-gradient(-135deg, rgb(60, 60, 60), #000000);
    display: flex;
    align-items: center;
    justify-content: center;/*real center*/
    padding: 1em; /* ป้องกันขอบติดจอบนมือถือ */
}
 
.container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2em;
    color: white;
    background: rgba(255, 255, 255, 0.3);
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
    border-radius: 2em;
    padding: 4em 3em;
    position: relative;
    max-width: 90vw; /* ป้องกันขอบชนบนมือถือ */
    
}

.title {
    font-size: 3em;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7); /* colorขอบ */
    text-align: center; /* จัดให้อยู่กึ่งกลาง */

}

.describe1 {
    font-size: 30px;
    font-weight: 20;
    color: black;
    text-align: center; /* ป้องกันข้อความยาวออกนอกจอบนมือถือ */
}

hr {
    width: 100%;
    background-color: white;
    height: 5px;
    border-radius: 1em;
    border: none;
    margin-top: -10px;
}

.timer-wrapper {
    position: relative;
    width: 100%;
    max-width: 200px; /* ป้องกันใหญ่เกินไป */
    height: auto;
    aspect-ratio: 1/1; /* ทำให้เป็นสี่เหลี่ยมจัตุรัส */
}

.timer {
    font-size: 3em;
    display: flex;
    align-items: center;
    justify-content: right;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%; /* ทำให้ตัวเลขกึ่งกลาง */
    height: 100%;
}






.button-wrapper {
    display: flex;
    gap: 1em;
}

button {
    font-size: 1.5em;
    padding: 0.5em 1.5em;
    border-radius: 0.5em;
    border: none;
    color: #FFF;
    cursor: pointer;
    transition: 0.2s ease-in-out;
}

button:hover {
    transform: translateY(-5px);
}




/* Settings button */
.settings-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            background: #000;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 100px;
            font-size: 16px;
        }

        /* Settings panel */
.settings-panel {
    position: absolute;
    top: 60px;
    right: 20px;
    width: 200px;
    background: rgba(0, 0, 0, 0.301);
    padding: 15px;
    border-radius: 10px;
    display: none;
}

.settings-panel label, .settings-panel button {
    color: white;
    font-size: 14px;
}

.settings-panel input[type="range"] {
    width: 100%;
    margin-top: 5px;
}

.toggle-btn {
    width: 100%;
    padding: 10px;
    background: rgb(237, 237, 237); 
    color: black !important; /* Ensure the text color stays black */
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-bottom: 10px;
}

.volume-slider{
    color: black;
}


/* Media Query สำหรับมือถือ (จอกว้างต่ำกว่า 600px) */
@media (max-width: 600px) {
    .container {
        padding: 2em; /* ลด padding บนมือถือ */
        max-width: 100%; /* ใช้พื้นที่เต็มที่ */
    }

    .title {
        font-size: 2em; /* ลดขนาด font */
    }

    .describe1 {
        font-size: 20px; /* ลดขนาดข้อความให้อ่านง่าย */
    }

    .timer-wrapper {
        max-width: 150px; /* ลดขนาดลง */
    }

    .timer {
        font-size: 2em; /* ลดขนาดตัวเลข */
    }
    .button-wrapper {
        flex-direction: column; /* ปรับปุ่มให้เรียงลงบนมือถือ */
        width: 100%; /* ทำให้ปุ่มยืดเต็มจอ */
        align-items: center;
    }

    button {
        width: 80%; /* ปรับขนาดปุ่มให้เหมาะกับมือถือ */
        font-size: 1.2em;
    }
}

#start { background-color: rgb(139, 209, 35); }
#stop { background-color: rgb(246, 25, 25); }
#reset { background-color: rgb(24, 137, 242); }
#toggle-button{background-color: rgb(237, 237, 237);}



.candle {
            position: relative;
            width: 40px;
            height: 100px;
            background-color: #ffcc66;
            border-radius: 5px;
            transition: height 1s linear;
            height: 100px; /* กำหนดค่าเริ่มต้น */
            min-height: 5px; /* ป้องกันหดลงจนหายไป */
        }
        
.flame {
    position: absolute;
    top: -35px;
    left: 50%;
    width: 20px;
    height: 35px;
    background: radial-gradient(ellipse at bottom, yellow, orange, red);
    border-radius: 50% 50% 40% 40% / 80% 80% 20% 20%;
    transform-origin: center bottom;
    animation: flicker 0.2s infinite alternate ease-in-out;
}

.fire-particle {
    position: absolute;
    top: -50px; /* Move fire particles higher */
    width: 5px;
    height: 5px;
    background-color: orange;
    border-radius: 50%;
    opacity: 1;
    animation: riseFire 1s ease-out forwards;
}

@keyframes riseFire {
    0% { transform: translate(0, 0) scale(1); opacity: 1; }
    100% { transform: translate(0px, -50px) scale(0.5); opacity: 0; } /* Move fire particles even higher */
}

.smoke-particle {
    position: absolute;
    top: -70px; /* Move smoke particles higher */
    width: 8px;
    height: 8px;
    background-color: rgba(150, 150, 150, 0.5);
    border-radius: 50%;
    opacity: 0.8;
    animation: riseSmoke 2.5s ease-out forwards;
}

@keyframes riseSmoke {
    0% { transform: translate(0, 0) scale(1); opacity: 0.8; }
    100% { transform: translate(10px, -100px) scale(1.5); opacity: 0; } /* Move smoke higher */
}


@keyframes flicker {
            0% { transform: translateX(-50%) scale(1.1); opacity: 0.9; }
            100% { transform: translateX(-50%) scale(0.9); opacity: 1; }
        }
        
.smoke {
            position: absolute;
            bottom: 100%;
            left: 50%;
            width: 10px;
            height: 10px;
            background-color: gray;
            border-radius: 50%;
            opacity: 0;
            animation: rise 2s ease-out forwards;
}
        
 @keyframes rise {
            0% { transform: translate(-50%, 0) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -100px) scale(0.5); opacity: 0; }
}



    </style>
</head>
<body>

    <!-- Settings Button -->
    <button class="settings-btn" onclick="toggleSettings()">⚙️</button>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <button id="toggle-button" class="toggle-btn">Turn Music Off</button>
        <label for="volume-slider">Volume:</label>
        <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1">
    </div>

     <!-- Audio element -->
     <audio id="background-music" loop>
        <source src="P.wav" type="audio/wav">
        Your browser does not support the audio element.
    </audio>
    


    <div class="container">
        <h1 class="title">Melt ME! The Candle!</h1>
        <h2 class="describe1">Read 25:00 | Rest 5:00</h2>
        <hr>

            <p class="timer" id="timer">25:00</p>
            <div class="candle" id="candle">
                <div class="flame" id="flame"></div>
            </div>
    </div>

        <div class="button-wrapper">
            <button id="start">Start</button>
            <button id="stop">Stop</button>
            <button id="reset">Reset</button>
        </div>
    </div>





    <script>
        // Get the audio element and the button
        const audio = document.getElementById('background-music');
        const button = document.getElementById('toggle-button');
        const volumeSlider = document.getElementById('volume-slider');
        const settingsPanel = document.getElementById('settingsPanel');

        //audio.play().catch(error => console.log("Auto-play blocked:", error));
            // Toggle settings panel visibility
        function toggleSettings() {
            settingsPanel.style.display = (settingsPanel.style.display === "block") ? "none" : "block";
        }

        // Flag to track the music state
        let isMusicPlaying = false;

        // Add event listener for button click
        button.addEventListener('click', () => {
            if (isMusicPlaying) {
                // Pause the music and update button text
                audio.pause();
                button.textContent = "Turn Music Off";
                button.style.backgroundColor = "rgb(237, 237, 237)"; // Change background
                 
            } else {
                // Play the music and update button text
                audio.play();
                button.textContent = "Turn Music On";
                button.style.backgroundColor = "rgb(139, 209, 35)"; // Change background
            }
            // Toggle the music state
            isMusicPlaying = !isMusicPlaying;
        });

        volumeSlider.addEventListener('input', () => {
            audio.volume = volumeSlider.value;
        });


        const start = document.getElementById("start");
        const stop = document.getElementById("stop");
        const reset = document.getElementById("reset");
       // const rest = document.getElementById("rest");
       
        const timer = document.getElementById("timer");

        let timeLeft = 10;
        let totalTime = 10; // Set full duration (example: 1 minute)
        let bufferNowTime;
        let fireInterval;
        let smokeInterval;

        const updateTimer = () => {
            
            const minutes = Math.floor(timeLeft / 60);
            const secs = timeLeft % 60;
            timer.innerHTML = `${minutes.toString().padStart(2, "0")}:${secs.toString().padStart(2, "0")}`;

        };


    const startTimer = () =>{
        start.disabled = true; // Disable start button to prevent spamming

        bufferNowTime = setInterval(() => {

            if (timeLeft > 0) {
                timeLeft--;
                document.getElementById("candle").style.height = (100 * (timeLeft / totalTime)) + "px";
                updateTimer();
            } else {
                clearInterval(bufferNowTime);
                clearInterval(fireInterval); // Stop fire particles
                clearInterval(smokeInterval); // Stop smoke particles when the flame is out
                document.getElementById("flame").style.display = "none";
                createSmoke(); 
                timeLeft=0;
                updateTimer();
            }
            
            
        }, 1000);//-1000ms = 1secs
    smokeInterval = setInterval(createSmokeParticles, 1500); // Generate smoke while flame is burning
    fireInterval = setInterval(createFireParticles, 500); // Generate fire particles
};
                    
            
            
const stopTimer = () => {
    clearInterval(bufferNowTime);
                
    /*            
    if (timeLeft > 1500) {
        timeLeft = 300; // Set count down 
        updateTimer();
                    
         // immediately
        let countdownInterval = setInterval(() => {
            timeLeft--; 
            updateTimer();
                        
            if (timeLeft <= 0) {
                timeLeft = 0; // Set count down 
                alert("Time's up!");
                totalTime = 1500; 
                clearInterval(countdownInterval); // Stop the countdown when time reaches 0
                start.disabled = false; // can press start
            }
        }, 1000); // Countdown every 1 sec
    } else {*/
    //  Time under or  =  expected val
    updateTimer();
    start.disabled = false; // can press start
    // }
        
        
            start.disabled = false; // can press start
        };




        const resetTimer = () => {
    clearInterval(bufferNowTime);
    clearInterval(fireInterval);
    clearInterval(smokeInterval);

    timeLeft = totalTime; // รีเซ็ตเวลา
    updateTimer();
    
    document.getElementById("candle").style.height = "100px"; // รีเซ็ตความสูงเทียน
    document.getElementById("flame").style.display = "block"; // แสดงเปลวไฟใหม่

    start.disabled = false;
};




        document.addEventListener("visibilitychange", () => {
            if (document.hidden) {
                stopTimer();
            }
        });


function createFireParticles() {
    if (timeLeft <= 0) return; // Stop fire particles when time is up

    for (let i = 0; i < 3; i++) {  
        setTimeout(() => {
            const fire = document.createElement("div");
            fire.classList.add("fire-particle");

            // More random positioning
            let randomX = Math.random() * 20 - 10; // Random left movement (-10 to 10)
            let randomY = Math.random() * 10 - 5;  // Random upward movement (-5 to 5)
            
            fire.style.left = `calc(50% + ${randomX}px)`;
            fire.style.top = `calc(-50px + ${randomY}px)`;
            fire.style.animationDuration = (0.5 + Math.random() * 0.5) + "s"; 
            
            document.getElementById("candle").appendChild(fire);
            setTimeout(() => fire.remove(), 1000); // Remove fire after animation
        }, i * 100);
    }
}

function createSmokeParticles() {
    if (timeLeft <= 0) return; // Stop smoke particles when time is up

    for (let i = 0; i < 3; i++) {  
        setTimeout(() => {
            const smoke = document.createElement("div");
            smoke.classList.add("smoke-particle");

            // More random positioning
            let randomX = Math.random() * 20 - 10; // Random left movement (-10 to 10)
            let randomY = Math.random() * 15 - 7;  // Random slight vertical variation (-7 to 7)

            smoke.style.left = `calc(50% + ${randomX}px)`;
            smoke.style.top = `calc(-70px + ${randomY}px)`;
            smoke.style.animationDuration = (2 + Math.random()) + "s"; // Random duration

            document.getElementById("candle").appendChild(smoke);
            setTimeout(() => smoke.remove(), 3000); // Remove after animation
        }, i * 300);
    }
}



        function createSmoke() {
            const smoke = document.createElement("div");
            smoke.classList.add("smoke");
            document.getElementById("candle").appendChild(smoke);
            setTimeout(() => smoke.remove(), 2000); // Remove after animation
        }
        updateTimer(); // Initialize the timer display



        start.addEventListener("click", startTimer);
        stop.addEventListener("click", stopTimer);
        reset.addEventListener("click", resetTimer);

        /*rest.addEventListener("click", () => {
                timeLeft += 5; // Add 5 minutes (300 seconds)
                //totalTime += 5; // Increase total time for progress calculation
                updateTimer(); // Update the display
            });*/
    </script>

</body>
</html>
